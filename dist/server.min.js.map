{"version":3,"sources":["server.js"],"names":["express","require","mongoose","Server","path","cors","multer","PDFDocument","config","app","env","PORT","use","limit","urlencoded","extended","text","MONGO_URI","process","connect","useNewUrlParser","useUnifiedTopology","log","err","console","error","req","file","cb","uploadPath","join","__dirname","fs","existsSync","mkdirSync","type","Date","now","Math","round","random","extname","originalname","then","res","send","post","_req$body","regeneratorRuntime","async","_context","prev","next","storage","destination","password","uniqueSuffix","status","json","stop","get","_context2","msg","upload","single","email","filename","_context3","_context4","doc","pipe","end","server","http","createServer","origin","io","on","socket","id","listen","concat"],"mappings":"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","file":"server.min.js","sourcesContent":["// server.js\r\nconst express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst cors = require('cors');\r\nconst { Server } = require('socket.io');\r\nconst http = require('http');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst multer = require('multer');\r\nconst PDFDocument = require('pdfkit');\r\n\r\nrequire('dotenv').config();\r\n\r\nconst app = express();\r\nconst PORT = process.env.PORT || 3000;\r\n\r\n// Middlewares\r\napp.use(cors());\r\napp.use(express.json({ limit: '50mb' })); // Para JSON grandes\r\napp.use(express.urlencoded({ extended: true, limit: '50mb' })); // Para form-data\r\napp.use(express.text({ type: 'text/plain' })); // Para text/plain\r\n\r\n// Conexión a MongoDB Atlas\r\nconst MONGO_URI = process.env.MONGO_URI || 'tu_mongo_uri_aqui';\r\nmongoose.connect(MONGO_URI, {\r\n  useNewUrlParser: true,\r\n  useUnifiedTopology: true,\r\n})\r\n.then(() => console.log('MongoDB conectado'))\r\n.catch(err => console.error('Error al conectar MongoDB:', err));\r\n\r\n// Configuración de Multer\r\nconst storage = multer.diskStorage({\r\n  destination: (req, file, cb) => {\r\n    const uploadPath = path.join(__dirname, 'uploads');\r\n    if (!fs.existsSync(uploadPath)) fs.mkdirSync(uploadPath);\r\n    cb(null, uploadPath);\r\n  },\r\n  filename: (req, file, cb) => {\r\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\r\n    cb(null, uniqueSuffix + path.extname(file.originalname));\r\n  }\r\n});\r\nconst upload = multer({ storage });\r\n\r\n// Rutas\r\napp.get('/', (req, res) => {\r\n  res.send('Backend funcionando correctamente');\r\n});\r\n\r\n// Login\r\napp.post('/login', async (req, res) => {\r\n  try {\r\n    const { email, password } = req.body;\r\n    // Aquí tu lógica de login\r\n    // Ejemplo:\r\n    // const user = await User.findOne({ email, password });\r\n    // if (!user) return res.status(401).json({ msg: 'Usuario no encontrado' });\r\n    // res.json(user);\r\n    res.json({ msg: 'Login simulado' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en login' });\r\n  }\r\n});\r\n\r\n// Productos\r\napp.get('/productos', async (req, res) => {\r\n  try {\r\n    // const productos = await Producto.find();\r\n    // res.json(productos);\r\n    res.json({ msg: 'Productos simulados' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al obtener productos' });\r\n  }\r\n});\r\n\r\n// Banner\r\napp.post('/banner', upload.single('image'), (req, res) => {\r\n  try {\r\n    if (!req.file) return res.status(400).json({ msg: 'No se subió la imagen' });\r\n    res.json({ msg: 'Imagen subida', file: req.file.filename });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al subir banner' });\r\n  }\r\n});\r\n\r\n// Favoritos\r\napp.post('/favoritos', async (req, res) => {\r\n  try {\r\n    // const { userId, productoId } = req.body;\r\n    // Lógica de favoritos\r\n    res.json({ msg: 'Favorito agregado simuladamente' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en favoritos' });\r\n  }\r\n});\r\n\r\n// Cotizaciones\r\napp.post('/cotizaciones', async (req, res) => {\r\n  try {\r\n    // const cotizacion = new Cotizacion(req.body);\r\n    // await cotizacion.save();\r\n    res.json({ msg: 'Cotización registrada simuladamente' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en cotizaciones' });\r\n  }\r\n});\r\n\r\n// PDF\r\napp.get('/pdf', (req, res) => {\r\n  try {\r\n    const doc = new PDFDocument();\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    doc.text('PDF generado correctamente');\r\n    doc.pipe(res);\r\n    doc.end();\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al generar PDF' });\r\n  }\r\n});\r\n\r\n// Servidor HTTP + Socket.io\r\nconst server = http.createServer(app);\r\nconst io = new Server(server, { cors: { origin: '*' } });\r\n\r\nio.on('connection', socket => {\r\n  console.log('Cliente conectado', socket.id);\r\n  socket.on('disconnect', () => console.log('Cliente desconectado', socket.id));\r\n});\r\n\r\n// Iniciar servidor\r\nserver.listen(PORT, () => {\r\n  console.log(`Servidor corriendo en http://localhost:${PORT}`);\r\n});\r\n"]}