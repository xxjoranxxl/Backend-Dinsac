{"version":3,"sources":["server.js"],"names":["express","require","mongoose","cors","Server","http","path","fs","multer","PDFDocument","config","app","PORT","process","env","use","json","limit","urlencoded","extended","text","type","MONGO_URI","connect","useNewUrlParser","useUnifiedTopology","then","console","log","err","error","storage","diskStorage","destination","req","file","cb","uploadPath","join","__dirname","existsSync","mkdirSync","filename","uniqueSuffix","Date","now","Math","round","random","extname","originalname","upload","get","res","send","post","body","email","password","msg","status","single","doc","setHeader","pipe","end","server","createServer","io","origin","on","socket","id","listen"],"mappings":"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","sourcesContent":["// server.js\r\nconst express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst cors = require('cors');\r\nconst { Server } = require('socket.io');\r\nconst http = require('http');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst multer = require('multer');\r\nconst PDFDocument = require('pdfkit');\r\n\r\nrequire('dotenv').config();\r\n\r\nconst app = express();\r\nconst PORT = process.env.PORT || 3000;\r\n\r\n// Middlewares\r\napp.use(cors());\r\napp.use(express.json({ limit: '50mb' })); // Para JSON grandes\r\napp.use(express.urlencoded({ extended: true, limit: '50mb' })); // Para form-data\r\napp.use(express.text({ type: 'text/plain' })); // Para text/plain\r\n\r\n// Conexión a MongoDB Atlas\r\nconst MONGO_URI = process.env.MONGO_URI || 'tu_mongo_uri_aqui';\r\nmongoose.connect(MONGO_URI, {\r\n  useNewUrlParser: true,\r\n  useUnifiedTopology: true,\r\n})\r\n.then(() => console.log('MongoDB conectado'))\r\n.catch(err => console.error('Error al conectar MongoDB:', err));\r\n\r\n// Configuración de Multer\r\nconst storage = multer.diskStorage({\r\n  destination: (req, file, cb) => {\r\n    const uploadPath = path.join(__dirname, 'uploads');\r\n    if (!fs.existsSync(uploadPath)) fs.mkdirSync(uploadPath);\r\n    cb(null, uploadPath);\r\n  },\r\n  filename: (req, file, cb) => {\r\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\r\n    cb(null, uniqueSuffix + path.extname(file.originalname));\r\n  }\r\n});\r\nconst upload = multer({ storage });\r\n\r\n// Rutas\r\napp.get('/', (req, res) => {\r\n  res.send('Backend funcionando correctamente');\r\n});\r\n\r\n// Login\r\napp.post('/login', async (req, res) => {\r\n  try {\r\n    const { email, password } = req.body;\r\n    // Aquí tu lógica de login\r\n    // Ejemplo:\r\n    // const user = await User.findOne({ email, password });\r\n    // if (!user) return res.status(401).json({ msg: 'Usuario no encontrado' });\r\n    // res.json(user);\r\n    res.json({ msg: 'Login simulado' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en login' });\r\n  }\r\n});\r\n\r\n// Productos\r\napp.get('/productos', async (req, res) => {\r\n  try {\r\n    // const productos = await Producto.find();\r\n    // res.json(productos);\r\n    res.json({ msg: 'Productos simulados' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al obtener productos' });\r\n  }\r\n});\r\n\r\n// Banner\r\napp.post('/banner', upload.single('image'), (req, res) => {\r\n  try {\r\n    if (!req.file) return res.status(400).json({ msg: 'No se subió la imagen' });\r\n    res.json({ msg: 'Imagen subida', file: req.file.filename });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al subir banner' });\r\n  }\r\n});\r\n\r\n// Favoritos\r\napp.post('/favoritos', async (req, res) => {\r\n  try {\r\n    // const { userId, productoId } = req.body;\r\n    // Lógica de favoritos\r\n    res.json({ msg: 'Favorito agregado simuladamente' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en favoritos' });\r\n  }\r\n});\r\n\r\n// Cotizaciones\r\napp.post('/cotizaciones', async (req, res) => {\r\n  try {\r\n    // const cotizacion = new Cotizacion(req.body);\r\n    // await cotizacion.save();\r\n    res.json({ msg: 'Cotización registrada simuladamente' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error en cotizaciones' });\r\n  }\r\n});\r\n\r\n// PDF\r\napp.get('/pdf', (req, res) => {\r\n  try {\r\n    const doc = new PDFDocument();\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    doc.text('PDF generado correctamente');\r\n    doc.pipe(res);\r\n    doc.end();\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: 'Error al generar PDF' });\r\n  }\r\n});\r\n\r\n// Servidor HTTP + Socket.io\r\nconst server = http.createServer(app);\r\nconst io = new Server(server, { cors: { origin: '*' } });\r\n\r\nio.on('connection', socket => {\r\n  console.log('Cliente conectado', socket.id);\r\n  socket.on('disconnect', () => console.log('Cliente desconectado', socket.id));\r\n});\r\n\r\n// Iniciar servidor\r\nserver.listen(PORT, () => {\r\n  console.log(`Servidor corriendo en http://localhost:${PORT}`);\r\n});\r\n"],"file":"server.dev.js"}